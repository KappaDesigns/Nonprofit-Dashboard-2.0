<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: util/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: util/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @description Implements util functions for all modules in the library
 * @author Evan Coulson &lt;ivansonofcoul@gmail.com>
 * 
 * @module util
 * 
 * @requires fs
 * @requires path
 * @requires Crypto
 * @requires module:util/Logger
 */
const fs = require('fs');
const path = require('path');
const Logger = require('../util/Logger');
const Crypto = require('crypto');

const logger = Logger('lib.js', ['error', 'debug']);

const configPath = path.resolve(__dirname, '../', '../', 'config.json');

/**
 * @description reads the config and returns a javascript object
 * @returns {Object} represents the config
 * @async
 */
function readConfig() {
	return new Promise(function handlePromise(resolve) {
		fs.readFile(configPath, 'utf-8', function handleRead(err, data) {
			if (err) {
				logger.error(`Error reading config.\nError: ${err}`);
				throw err;
			}
			logger.debug('Config read successfully ' + data);
			return resolve(JSON.parse(data));
		});
	});
}

/**
 * @description reads the config syncronously and returns a javascript object
 * @returns {Object} returns an object representing the config
 */
function readConfigSync() {
	return JSON.parse(fs.readFileSync(configPath, 'utf-8'));
}

/**
 * @description takes the global file path of a file within
 * the local site stored and resolves the string to pertain to the ./site
 * dir as the root of the path
 * @param {String} filePath path to file
 * @returns {String} returns localized string to the ./site root
 */
function localizePath(filePath) {
	let subpaths = filePath.split('/');
	for (let i = 0; i &lt; subpaths.length; i++) {
		if (subpaths[i] == 'site') {
			subpaths.splice(0, i + 1);
			break;
		}
	}
	filePath = '';
	for (let i = 0; i &lt; subpaths.length; i++) {
		if (i != 0) {
			filePath += '/' + subpaths[i];
		} else {
			filePath += subpaths[i];
		}
	}
	return filePath;
}

/**
 * @description returns a capitalized string.
 * @param {String} string takes in a string to Capitalize the first 
 * letter off
 * @returns {String} returns the capitalized string
 */
function capitalizeString(string) {
	return string.charAt(0).toUpperCase() + string.slice(1);
}

/**
 * @description returns the global file path
 * @param {String} filePath takes in the local site file path
 * @returns {String} returns the global file path of a local path
 */
function globalizePath(filePath) {
	return path.resolve(__dirname, '../../site', filePath);
}

/**
 * @description decrypts a given string using the confgured secret
 * @param {Object} config app configuration object
 * @param {String} str string to decrypt
 * @param {Function} next callback when finished decrypting
 * @returns {String} returns the decrypted string to the
 * callback
 * @async
 */
function decrypt(config, str, next) {
	logger.info('decrypting...');
	const decipher = Crypto.createDecipher('aes192', config.secret);
	let decrypted = '';

	decipher.on('readable', function handleRead() {
		const data = decipher.read();
		if (data) {
			decrypted += data.toString('utf8');
		}
	});

	decipher.on('end', function handleClose() {
		logger.info('finished decrypting...');
		return next(decrypted);
	});
	decipher.write(str, 'hex');
	decipher.end();
}

/**
 * @description handles successful data requests
 * @param {Object} data the data to be returned by the response
 * @param {*} code the response code of the response
 * @param {*} res the response generated by express
 * @param {*} next the next layer in the middleware generated by express
 * @returns {Object} returns the next object in the middleware stack
 */
function handleSuccess(data, code, res, next) {
	res.status(code).send({
		success: true,
		data: data,
	});
	return next();
}

/**
 * @description handles errors when requesting data
 * @param {*} err the error object
 * @param {*} code the error code for the response
 * @param {*} res the response generated by express
 * @param {*} next the next layer in the middleware generated by express
 * @returns {Object} returns the next object in the middleware stack
 */
function handleError(err, code, res, next) {
	res.status(code).send({
		success: false,
		error: err,
	});
	return next(err);
}

module.exports = {
	readConfig: readConfig,
	readConfigSync: readConfigSync,
	decrypt: decrypt,
	globalizePath: globalizePath,
	localizePath: localizePath,
	capitalizeString: capitalizeString,
	handleError: handleError,
	handleSuccess: handleSuccess,
};</code></pre>
        </article>
    </section>




</div>

<nav>
<<<<<<< HEAD
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_Site.html">lib/Site</a></li><li><a href="module-util.html">util</a></li><li><a href="module-util_Logger.html">util/Logger</a></li><li><a href="module-util_MYSQL.html">util/MYSQL</a></li></ul><h3>Interfaces</h3><ul><li><a href="DragEvent.html">DragEvent</a></li><li><a href="Event.html">Event</a></li><li><a href="FocusEvent.html">FocusEvent</a></li><li><a href="KeyboardEvent.html">KeyboardEvent</a></li><li><a href="MouseEvent.html">MouseEvent</a></li><li><a href="TouchEvent.html">TouchEvent</a></li><li><a href="UIEvent.html">UIEvent</a></li><li><a href="WheelEvent.html">WheelEvent</a></li></ul><h3>Global</h3><ul><li><a href="global.html#destructor">destructor</a></li><li><a href="global.html#isPersistent">isPersistent</a></li><li><a href="global.html#persist">persist</a></li></ul>
=======
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_RequestValidator.html">lib/RequestValidator</a></li><li><a href="module-lib_Site.html">lib/Site</a></li><li><a href="module-lib_SiteResource.html">lib/SiteResource</a></li><li><a href="module-util.html">util</a></li><li><a href="module-util_Logger.html">util/Logger</a></li><li><a href="module-util_MYSQL.html">util/MYSQL</a></li></ul>
>>>>>>> master
</nav>

<br class="clear">

<footer>
<<<<<<< HEAD
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Dec 18 2017 14:45:39 GMT-0800 (PST)
=======
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Feb 15 2018 21:26:05 GMT-0800 (PST)
>>>>>>> master
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
